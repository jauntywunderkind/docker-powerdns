#!/bin/sh

source pdns-script-helpers

pgConn(){
}

# build a connection string from kube configuration
pgPass(){

}

prep(){
	local pv=$(_pdnsConfVars)
	local user="$(pdnsVar gpgsql-user $pv)"
	local password="$(pdnsVar gpgsql-password "$pv")"
	local host="$(pdnsVar gpgsql-host "$pv")"
	local port="$(pdnsVar gpgsql-port "$pv" 5432)"
	local dbname="$(pdnsVar gpgsql-dbname "$pv")"
	local extra="$(pdnsVar gpgsql-extra-connection-parameters "$pv")"
	[ -n "$extra" ] && extra=$(echo $extra | sed 's/\s/\&/g') # what other url-ization ought happen here?

	# write password to file
	echo "$host:$port:$dbname:$user:$password" > ~/.pgpass
	# build connection-string
	echo "postgres://$user@$host:$port/$dbname?$extra"
}

exec psql "$(prep)" $*
